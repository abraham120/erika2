Author: Francesco Esposito
Company: Evidence Srl

This demo shows the use of CAN Calibration Protocol (CCP) to monitor a tension
(expressed in mV) on a potentiometer output pin. To do that, please connect
pin1 of POT_EN connector to PIN7 of PJ7 connector. Notice that pins are
numbered from 0 to N. To communicate with the board use the CAN H interface
provided by the EVB with J28 closed and J27 open (both connectors open).
The communication is performed at 500 Kb.

The following have been tested with Freescale Codewarrior 10.2 and MPC56XX EVB
(Evaluation Board).

To test the potentiometer output use the following list of CCP commands, where
0x201 is the master (eg. your PC using PCAN for instance but feel free to
use your favorite CAN-PC dongle) and 0x200 the slave (the EVB).

// CONNECT
// board: 0x39
0x00000201 8  0x01 0x45 0x39 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x45 0x00 0x00 0x00 0x00 0x00

// SET_S_STATUS
// start calibration
0x00000201 8  0x0c 0x46 0x01 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x46 0x00 0x00 0x00 0x00 0x00

// GET_DAQ_SIZE
// num=0
// id:0x200
0x00000201 8  0x14 0x47 0x00 0x00 0x00 0x00 0x02 0x00
0x00000200 8  0xff 0x00 0x47 0x19 0x00 0x00 0x00 0x00

// START_STOP_ALL
// cmd: stop
0x00000201 8  0x08 0x4e 0x00 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x4e 0x00 0x00 0x00 0x00 0x00

// SET_DAQ_PTR
// daq=0
// odt=0
// event=0
0x00000201 8  0x15 0x56 0x00 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x56 0x00 0x00 0x00 0x00 0x00

// WRITE_DAQ
// length:2
// address: 0x 40 00 00 10 (because output potentiometer is at this address)
0x00000201 8  0x16 0x57 0x02 0x00 0x40 0x00 0x00 0x10
0x00000200 8  0xff 0x00 0x57 0x00 0x00 0x00 0x00 0x00

// SET_S_STATUS
// status: daq and cal initialized
0x00000201 8  0x0c 0x64 0x03 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x64 0x00 0x00 0x00 0x00 0x00

// START_STOP
// start:1
// daq:0
// odt:0
// channel:1
// rate: 0x 00 02
0x00000201 8  0x06 0x65 0x01 0x00 0x00 0x01 0x00 0x02
0x00000200 8  0xff 0x22 0x65 0x00 0x00 0x00 0x00 0x00

The previous command starts DAQ sampling and CCP feedback to the master.
The output has this format:

0x00000200 8  0x00 0x01 0x23 0x00 0x00 0x00 0x00 0x00

Where byte1 and byte2 (0x01 0x23) represent the voltage output measured at the
potentiometer output. In this case: 0x123 Volt

Using the potentiometer this value should range in 0x00 to 0xC80 at runtime
(about 0 - 3300 mvolt)

To stop sampling and send:

// START_STOP_ALL
0x00000201 8  0x08 0x67 0x00 0x00 0x00 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x67 0x00 0x00 0x00 0x00 0x00

// DISCONNECT
// board:39
// session end: 1
0x00000201 8  0x07 0x69 0x01 0x00 0x39 0x00 0x00 0x00
0x00000200 8  0xff 0x00 0x69 0x00 0x00 0x00 0x00 0x00

NOTICE TAHT: PCAN_CCP_TEST_LEOPARD_ADC.xmt is the a useful PCAN-View profile
to test this demo. To use it please open this file with PCAN-View.

